<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluzeClient Header Formatting</title>
</head>
<body>
    <h1>FluzeClient Header Formatting</h1>
    <div class="content">
        <textarea id="input"></textarea>
        <textarea id="output"></textarea>
    </div>
    <script>
        var input = document.getElementById('input');
        var output = document.getElementById('output');

        window.onload = (function () {
            input.addEventListener('input', e => {
                handleInput(e.target.value)
            });
        })

        function handleInput(input) {
            let initialHeaders = input.split('\n')
            var headerStruct = {}
            initialHeaders.forEach(header => {
                let splitHeader = header.split(/\s{2,}|\t/)
                headerStruct[splitHeader[0]] = splitHeader[1]
            });

            Object.keys(headerStruct).forEach(key => {
                if (key.startsWith(':')) {
                    delete headerStruct[key]
                }
            })
            
            var out = "{\n"
            Object.keys(headerStruct).forEach((key) => {
                out += `"${key}": {"${headerStruct[key].replace(/\"/g, '\\"')}"},\n`
            })

            var headerOrder = "http.HeaderOrderKey: {"
            Object.keys(headerStruct).forEach((key) => {
                headerOrder += `"${key}",`
            })
            headerOrder = headerOrder.slice(0, -1)
            headerOrder += "},\n"
            out += headerOrder

            out += 'http.PseudoHeaderOrderKey:   {":method", ":authority", ":scheme", ":path"},\n'
            out += "}"

            output.value = out

        }

    </script>
    <style>
        .content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            column-gap: 1rem;
            justify-content: center;
            align-items: center;
        }

        textarea {
            width: 100%;
            height: 100%;
            resize: none;
            min-height: 800px;
        }
    </style>
</body>
</html>